<head>   
    <meta id="META" name="viewport" content="width=device-width, initial-scale=1.0" >
    <link rel="icon" type="image/png" href="/favicon.png">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <meta name="mobile-web-app-capable" content="yes">
    <style>
:root {
    /* metric and material icon sizing
     * two variations for large and smaller screens
     */
    --metric-font-size-large-screen: 3.0vw;
    --metric-font-size-small-screen: 4.0vw;
    --metric-font-size-portrait-screen: 8.0vw;

    --metric-unit-font-size-large-screen: 1.0vw;
    --metric-unit-font-size-small-screen: 1.5vw;
    --metric-unit-font-size-portrait-screen: 3.0vw;

    --title-font-size-large-screen: 1.0vw;
    --title-font-size-small-screen: 1.5vw;
    --title-font-size-portrait-screen: 4.5vw;

    --metric-font-size: var(--metric-font-size-large-screen);
    --metric-unit-font-size: var(--metric-unit-font-size-large-screen);
    --title-font-size: var(--title-font-size-large-screen);
}
        #bgdark {
            height: 200px;
            /*background-color: #202025; */
            background-color: #000000; 
        }
        .title{
            font-size: var(--title-font-size);
            color: white;
        }
        .metric{
            font-size: var(--metric-font-size);
        }
        .metric-white{
            color: white;
        }
        .metric-grey{
            color: #525252;
        }
        .metric-yellow{
            color: #DDDD00;
        }
        .metric-orange{
            color: #FC6600;
        }
        .metric-red{
            color: #CC0000;
        }
        .metric-green{
            color: 028A0F;
        }
        .metric-blue{
            color: #0096FF;
        }
        .metric-unit{
            font-size: var(--metric-unit-font-size);
            color: #929292;
        }
        g.google-visualization-tooltip { 
            /* fixes flickering tooltip */
            pointer-events: none 
        }
        .material-icons.metric { 
            font-size: var(--metric-font-size);
        }
        .custom-tooltip {
            --bs-tooltip-bg: var(--bs-primary);
        }
    </style>
    <title>Solar Monitor</title>

    <script>
        // popper tooltips init
        $(function(){
            $('body').tooltip({ selector: '[data-bs-toggle="tooltip"]' });
        });

        // Google charts
        google.charts.load('current', {'packages': ['corechart']});
        google.charts.load('current', {'packages':['gauge']});

        var data_dict = {
            year: [],
            month: [],
            day: []
        };

        // quick refresh timer 
        // used for initial refresh and resize events
        var quick_refresh_timer = setInterval(quick_refresh, 1000);

        // standard refresh timer 
        // normal refresh timer when window is
        // in focus
        var refresh_interval = 5000
        var standard_refresh_timer = setInterval(refresh_data, refresh_interval);

        // hide dashboard initially
        $( document ).ready(function() {
            $("#dashboard").hide();
        });

        // Window focus activates/deactivates 
        // the standard refresh timer
        // avoids background activity when not in focus
        $(window).focus(function() {
            clearInterval(standard_refresh_timer);
            standard_refresh_timer = setInterval(refresh_data, refresh_interval);
            refresh_data();
        }).blur(function() {
            clearInterval(standard_refresh_timer);
        });

        // forced fast refresh on resize to redraw
        $(window).resize(function () { 
            clearInterval(quick_refresh_timer);
            quick_refresh_timer = setInterval(quick_refresh, 1000);
        });

        // does one refresh and clears the 
        // quick refresh timer
        function quick_refresh() {
            clearInterval(quick_refresh_timer);
            refresh_data();
        }

        var refresh_error_count = 0;

        // tracking the current overall
        // metric series
        var overall_metric_index = 0;
        var overall_metric_cycle_interval = 5000;
        var overall_metric_cycle_ts = 0;

        function refresh_data() {
            console.log("refresh_data()");

            var data_request = $.get('/data');

            data_request.fail(function() {
                refresh_error_count += 1;
                $("#last_updated").html(`Error (${refresh_error_count})`);
            });           

            data_request.done(function(data) {
                data_dict = JSON.parse(data);

                // check data dict refresh and update if required
                // Note: shown as second and JS operates on msecs
                if ('refresh_interval' in data_dict) {
                    data_dict_refresh = data_dict.refresh_interval * 1000
                    if (refresh_interval != data_dict_refresh) {
                        refresh_interval = data_dict_refresh;

                        // protection of min 5 sec refresh
                        if (refresh_interval < 5000) {
                            refresh_interval = 5000;
                        }

                        // reset timer
                        clearInterval(standard_refresh_timer);
                        standard_refresh_timer = setInterval(refresh_data, refresh_interval);
                        console.log('new refresh interval:' + refresh_interval);
                    }
                }

                if ('metric_cycle_interval' in data_dict) {
                    overall_metric_cycle_interval = data_dict.metric_cycle_interval * 1000;
                    console.log('metric cycle interval:' + overall_metric_cycle_interval);

                    // protection of min 5 sec refresh
                    if (overall_metric_cycle_interval < 5000) {
                        overall_metric_cycle_interval = 5000;
                    }
                    console.log('metric cycle interval:' + overall_metric_cycle_interval);
                }

                // show the dashboard only when we have
                // a valid last updated timestamp
                if (data_dict.last_updated > 0) {
                    $("#dashboard").show();
                }

                // reset error count
                refresh_error_count = 0

                // rotating metrics for "overall" section
                // rotates every N msecs 
                var now = Date.now();
                if (now - overall_metric_cycle_ts >= overall_metric_cycle_interval) {
                    metric_list = Object.keys(data_dict.metrics);
                    for (i = 0; i < metric_list.length; i++) {
                        overall_metric_index = (overall_metric_index + 1) % metric_list.length;
                        if (metric_list[overall_metric_index] != 'live') {
                            overall_metric_key = metric_list[overall_metric_index];
                            $("#overall_donut_title").html("Usage for " + data_dict['metrics'][overall_metric_key]['title']);
                            overall_metric_cycle_ts = now;
                            break;
                        }
                    }
                }

                live_source = data_dict.metrics.live;
                overall_source = data_dict.metrics[overall_metric_key];

                watt_unit_str = 'W'
                kw_unit_str = 'kW'

                // live values to 2 decimal places when >= 1kW
                // or as watts when < 1.0 kW
                if (live_source.import >= 1) {
                    $("#live_import").html(live_source.import.toFixed(2));
                    $("#live_import_unit").html(kw_unit_str);
                }
                else {
                    $("#live_import").html(Math.floor(live_source.import * 1000));
                    $("#live_import_unit").html(watt_unit_str);
                }
                if (live_source.import > 0) {
                    $("#live_import").removeClass().addClass("metric metric-red");
                    $("#live_import_icon").removeClass().addClass("material-icons metric metric-red");
                }
                else {
                    $("#live_import").removeClass().addClass("metric metric-green");
                    $("#live_import_icon").removeClass().addClass("material-icons metric metric-green");
                }

                if (live_source.solar >= 1) {
                    $("#live_solar").html(live_source.solar.toFixed(2));
                    $("#live_solar_unit").html(kw_unit_str);
                }
                else {
                    $("#live_solar").html(Math.floor(live_source.solar * 1000));
                    $("#live_solar_unit").html(watt_unit_str);
                }
                if (live_source.solar > 0) {
                    $("#live_solar").removeClass().addClass("metric metric-yellow");
                    $("#live_solar_icon").removeClass().addClass("material-icons metric metric-yellow");
                }
                else {
                    $("#live_solar").removeClass().addClass("metric metric-grey");
                    $("#live_solar_icon").removeClass().addClass("material-icons metric metric-grey");
                }

                if (live_source.export >= 1) {
                    $("#live_export").html(live_source.export.toFixed(2));
                    $("#live_export_unit").html(kw_unit_str);
                }
                else {
                    $("#live_export").html(Math.floor(live_source.export * 1000));
                    $("#live_export_unit").html(watt_unit_str);
                }
                if (live_source.export > 0) {
                    $("#live_export").removeClass().addClass("metric metric-blue");
                    $("#live_export_icon").removeClass().addClass("material-icons metric metric-blue");
                }
                else {
                    $("#live_export").removeClass().addClass("metric metric-grey");
                    $("#live_export_icon").removeClass().addClass("material-icons metric metric-grey");
                }

                if (live_source.consumed >= 1) {
                    $("#live_consumed").html(live_source.consumed.toFixed(2));
                    $("#live_consumed_unit").html(kw_unit_str);
                } 
                else {
                    $("#live_consumed").html(Math.floor(live_source.consumed * 1000));
                    $("#live_consumed_unit").html(watt_unit_str);
                }
                if (live_source.import <= 0) {
                    $("#live_consumed").removeClass().addClass("metric metric-green");
                    $("#live_consumed_icon").removeClass().addClass("material-icons metric metric-green");
                }
                else if (live_source.solar > 0) {
                    $("#live_consumed").removeClass().addClass("metric metric-orange");
                    $("#live_consumed_icon").removeClass().addClass("material-icons metric metric-orange");
                }
                else {
                    $("#live_consumed").removeClass().addClass("metric metric-red");
                    $("#live_consumed_icon").removeClass().addClass("material-icons metric metric-red");
                }

                // overall values to 3 decimal places
                $("#overall_import").html(overall_source.import.toFixed(0));
                if (overall_source.import > 0) {
                    $("#overall_import").removeClass().addClass("metric metric-red");
                    $("#overall_import_icon").removeClass().addClass("material-icons metric metric-red");
                }
                else {
                    $("#overall_import").removeClass().addClass("metric metric-green");
                    $("#overall_import_icon").removeClass().addClass("material-icons metric metric-green");
                }

                $("#overall_solar").html(overall_source.solar.toFixed(0));
                if (overall_source.solar > 0) {
                    $("#overall_solar").removeClass().addClass("metric metric-yellow");
                    $("#overall_solar_icon").removeClass().addClass("material-icons metric metric-yellow");
                }
                else {
                    $("#overall_solar").removeClass().addClass("metric metric-grey");
                    $("#overall_solar_icon").removeClass().addClass("material-icons metric metric-grey");
                }

                $("#overall_export").html(overall_source.export.toFixed(0));
                if (overall_source.export > 0) {
                    $("#overall_export").removeClass().addClass("metric metric-blue");
                    $("#overall_export_icon").removeClass().addClass("material-icons metric metric-blue");
                }
                else {
                    $("#overall_export").removeClass().addClass("metric metric-grey");
                    $("#overall_export_icon").removeClass().addClass("material-icons metric metric-grey");
                }

                $("#overall_consumed").html(overall_source.consumed.toFixed(0));
                if (overall_source.import <= 0) {
                    $("#overall_consumed").removeClass().addClass("metric metric-green");
                    $("#overall_consumed_icon").removeClass().addClass("material-icons metric metric-green");
                }
                else if (overall_source.solar > 0) {
                    $("#overall_consumed").removeClass().addClass("metric metric-orange");
                    $("#overall_consumed_icon").removeClass().addClass("material-icons metric metric-orange");
                }
                else {
                    $("#overall_consumed").removeClass().addClass("metric metric-red");
                    $("#overall_consumed_icon").removeClass().addClass("material-icons metric metric-red");
                }

                kg_unit_str = 'kg'
                g_unit_str = 'g'
                if (overall_source.co2 >= 1) {
                    $("#overall_co2").html(overall_source.co2.toFixed(2));
                    $("#overall_co2_unit").html(kg_unit_str);
                }
                else {
                    $("#overall_co2").html(Math.floor(overall_source.co2 * 1000));
                    $("#overall_co2_unit").html(g_unit_str);
                }
                if (overall_source.co2 > 0) {
                    $("#overall_co2").removeClass().addClass("metric metric-green");
                    $("#overall_co2_icon").removeClass().addClass("material-icons metric metric-green");
                }
                else {
                    $("#overall_co2").removeClass().addClass("metric metric-grey");
                    $("#overall_co2_icon").removeClass().addClass("material-icons metric metric-grey");
                }

                if (overall_source.trees >= 1) {
                    $("#overall_trees").html(overall_source.trees.toFixed(0));
                }
                else {
                    $("#overall_trees").html(overall_source.trees.toFixed(2));
                }
                if (overall_source.trees > 0) {
                    $("#overall_trees").removeClass().addClass("metric metric-green");
                    $("#overall_trees_icon").removeClass().addClass("material-icons metric metric-green");
                }
                else {
                    $("#overall_trees").removeClass().addClass("metric metric-grey");
                    $("#overall_trees_icon").removeClass().addClass("material-icons metric metric-grey");
                }

                // render as HH:MM:SS
                var date = new Date(data_dict.last_updated * 1000);
                $("#last_updated").html(date.toLocaleTimeString());

                $("#window_width").html(window.innerWidth);
                $("#window_height").html(window.innerHeight);

                // height and width checks
                if (window.innerWidth <= window.innerHeight) {
                    // remove column spans to force vertical 
                    // stack
                    $("#metric_column").removeClass("col-4");
                    $("#chart_column").removeClass("col-8");

                    // metrics in two columns and show donuts
                    $("#live_donut_chart").show();
                    $("#overall_donut_chart").show();
                    $("#live_metric_grid").removeClass("row-cols-1").addClass("row-cols-2");
                    $("#overall_metric_grid").removeClass("row-cols-1").addClass("row-cols-2");

                    // set the portrait screen font sizes
                    document.body.style.setProperty("--metric-font-size", 'var(--metric-font-size-portrait-screen)');
                    document.body.style.setProperty("--metric-unit-font-size", 'var(--metric-unit-font-size-portrait-screen)');
                    document.body.style.setProperty("--title-font-size", 'var(--title-font-size-portrait-screen)');
                }
                else {
                    $("#metric_column").addClass("col-4");
                    $("#chart_column").addClass("col-8");

                    if (window.innerWidth < 1600 || window.innerHeight < 1080) {
                        // hide donuts and make metrics single
                        // column 
                        $("#live_donut_chart").hide();
                        $("#overall_donut_chart").hide();
                        $("#live_metric_grid").removeClass("row-cols-2").addClass("row-cols-1");
                        $("#overall_metric_grid").removeClass("row-cols-2").addClass("row-cols-1");

                        // set the small screen larger font sizes
                        document.body.style.setProperty("--metric-font-size", 'var(--metric-font-size-small-screen)');
                        document.body.style.setProperty("--metric-unit-font-size", 'var(--metric-unit-font-size-small-screen)');
                        document.body.style.setProperty("--title-font-size", 'var(--title-font-size-small-screen)');
                    }
                    else {
                        // metrics in two columns and show donuts
                        $("#live_donut_chart").show();
                        $("#overall_donut_chart").show();
                        $("#live_metric_grid").removeClass("row-cols-1").addClass("row-cols-2");
                        $("#overall_metric_grid").removeClass("row-cols-1").addClass("row-cols-2");

                        // set the large screen smaller font sizes
                        document.body.style.setProperty("--metric-font-size", 'var(--metric-font-size-large-screen)');
                        document.body.style.setProperty("--metric-unit-font-size", 'var(--metric-unit-font-size-large-screen)');
                        document.body.style.setProperty("--title-font-size", 'var(--title-font-size-large-screen)');
                    }
                }

                draw_charts();
            });
        }

        // chart globals to avoid memory growth
        var live_donut_chart;
        var overall_donut_chart;
        var day_chart;
        var month_chart;
        var year_chart;

        function draw_charts() {

            var chart_height = (window.innerHeight - 130) / 3;
            var donut_chart_height = chart_height * 0.9;

            // series fields and colour assignments
            const series_fields = ["import", "consumed", "solar", "solar_consumed", "export" ];

            const series_labels = {
                "import": "Grid Import",
                "consumed": "Total Consumption",
                "solar": "PV Yield",
                "solar_consumed": "PV Consumption",
                "export": "PV Export",
            };

            const series_colours = {
                "import": "#CC0000",
                "consumed": "#00487F",
                "solar": "#DDDD00",
                "solar_consumed": "#028A0F",
                "export": "#0096FF",
            };

            // live power distribution 

            if (live_donut_chart == undefined) {
                // first time creation
                live_donut_chart = new google.visualization.PieChart(document.getElementById('live_donut_chart'));
                overall_donut_chart = new google.visualization.PieChart(document.getElementById('overall_donut_chart'));
            }
            else {
                // wipe existing data
                live_donut_chart.clearChart();
                overall_donut_chart.clearChart();
            }

            // donut options (shared)

            // construct donut series and colour lists
            donut_series_list = []
            donut_colour_list = []

            for (series_field of series_fields) {
                if (data_dict.dashboard.donut[series_field]) {
                    donut_series_list.push(series_field)
                    donut_colour_list.push(series_colours[series_field])
                }
            }

            var donut_options = {
                colors: donut_colour_list,
                pieHole: 0.4,
                height: donut_chart_height,
                chartArea:{
                    top:10,
                    bottom:40,
                    left:0,
                    right:0,
                },
                legend: { 
                    alignment: 'center', 
                    position: 'bottom', 
                    maxLines: 3,
                    textStyle: {
                        fontSize: 18,
                        color: 'gray'
                    },
                },
                pieSliceText: 'percentage',
                pieSliceTextStyle: {
                    fontSize: 20,
                },
                backgroundColor: { fill:'transparent' },
                pieSliceBorderColor: 'transparent',
            };

            // live 
            live_source = data_dict.metrics.live;
            var live_data = new google.visualization.DataTable();
            live_data.addColumn('string', 'Source');
            live_data.addColumn('number', 'kW');

            for (series_field of donut_series_list) {
                live_data.addRows([
                    [series_labels[series_field], live_source[series_field] * 1000],
                ]);
            }

            // overall
            overall_source = data_dict.metrics[overall_metric_key];
            var overall_data = new google.visualization.DataTable();
            overall_data.addColumn('string', 'Source');
            overall_data.addColumn('number', 'kWh');

            for (series_field of donut_series_list) {
                overall_data.addRows([
                    [series_labels[series_field], overall_source[series_field] * 1000],
                ]);
            }

            // draw donuts
            live_donut_chart.draw(live_data, donut_options);
            overall_donut_chart.draw(overall_data, donut_options);

            // bar chart options (shared)

            // construct bar_chart series and colour lists
            bar_chart_series_list = []
            bar_chart_colour_list = []

            for (series_field of series_fields) {
                if (data_dict.dashboard.bar_chart[series_field]) {
                    bar_chart_series_list.push(series_field)
                    bar_chart_colour_list.push(series_colours[series_field])
                }
            }

            // common options
            // but the hAxis title will be tweaked
            var bar_chart_options = {
                colors: bar_chart_colour_list,
                hAxis: {
                    title: 'Hour',
                    titleTextStyle: {
                        color: 'white'
                    },
                    textStyle: {
                        color: 'gray'
                    },
                },
                vAxis: {
                    title: 'kwH',
                    titleTextStyle: {
                        color: 'white'
                    },
                    textStyle: {
                        color: 'gray'
                    },
                    gridlines: {
                        color: '#404040', 
                    },
                    minorGridlines: {
                        color: '#404040', 
                    },
                },
                chartArea:{
                    left:50,
                    right:20,
                },
                axisTitlesPosition: 'in',
                isStacked: true,
                height: chart_height,
                legend: { 
                    position: 'top', 
                    alignment: 'center', 
                    maxLines: 3,
                    textStyle: {
                        fontSize: 18,
                        color: 'gray'
                    },
                },
                backgroundColor: { 
                    fill:'transparent' 
                },
            };

            // day
            if (data_dict.day.length > 0) {

                if (day_chart == undefined) {
                    // first time creation
                    day_chart = new google.visualization.ColumnChart(document.getElementById('day_chart'));
                }
                else {
                    // wipe existing data
                    day_chart.clearChart();
                }

                var day_data = new google.visualization.DataTable();

                // hour is actually a number (int)
                // but we chart it as a string
                day_data.addColumn('string', 'Hour');

                for (series_field of bar_chart_series_list) {
                    day_data.addColumn('number', series_labels[series_field]);
                }

                day_data.addRows(data_dict.day.length);
                row = 0
                for (const item of data_dict.day) {
                    // set hour value as string
                    // prevents chart from splitting columns as fractions/averages
                    day_data.setCell(row, 0, item.hour.toString());
                    col = 1
                    for (series_field of bar_chart_series_list) {
                        day_data.setCell(row, col, item[series_field].toFixed(2));
                        col += 1;
                    }
                    row += 1;
                }

                bar_chart_options.hAxis.title = 'Hour';
                day_chart.draw(day_data, bar_chart_options);
            }

            // month 
            if (data_dict.month.length > 0) {

                if (month_chart == undefined) {
                    // first time creation
                    month_chart = new google.visualization.ColumnChart(document.getElementById('month_chart'));
                }
                else {
                    // wipe existing data
                    month_chart.clearChart();
                }

                var month_data = new google.visualization.DataTable();
                // present int day number as string
                month_data.addColumn('string', 'Day');

                for (series_field of bar_chart_series_list) {
                    month_data.addColumn('number', series_labels[series_field]);
                }

                month_data.addRows(data_dict.month.length);
                row = 0
                for (const item of data_dict.month) {
                    // force to string to prevent averaging of 
                    // column values
                    month_data.setCell(row, 0, item.day.toString());
                    col = 1
                    for (series_field of bar_chart_series_list) {
                        month_data.setCell(row, col, item[series_field].toFixed(2));
                        col += 1;
                    }
                    row += 1;
                }

                bar_chart_options.hAxis.title = 'Day';
                month_chart.draw(month_data, bar_chart_options);
            }

            // year
            if (data_dict.year.length > 0) {

                if (year_chart == undefined) {
                    // first time creation
                    year_chart = new google.visualization.ColumnChart(document.getElementById('year_chart'));
                }
                else {
                    // wipe existing data
                    year_chart.clearChart();
                }

                var year_data = new google.visualization.DataTable();
                year_data.addColumn('string', 'Month');

                for (series_field of bar_chart_series_list) {
                    year_data.addColumn('number', series_labels[series_field]);
                }

                year_data.addRows(data_dict.year.length);
                row = 0
                for (const item of data_dict.year) {
                    year_data.setCell(row, 0, item.month);
                    col = 1
                    for (series_field of bar_chart_series_list) {
                        year_data.setCell(row, col, item[series_field].toFixed(2));
                        col += 1;
                    }
                    row += 1;
                }

                bar_chart_options.hAxis.title = 'Month';
                year_chart.draw(year_data, bar_chart_options);
            }
        }

    </script>
</head>   

<body id="bgdark">
    <div id="dashboard" class="container-fluid" data-bs-theme="dark">
        <div class="row">

            <!-- Left column for live usage and metrics -->
            <div id="metric_column" class="col mt-2">

                <!-- Live donut -->
                <div class="card-transparent text-white text-center">
                    <div class="card-body text-center">
                        <center>
                            <!-- debugging output for window height/width
                                <span id="window_width"></span> x <span id="window_height"></span>
                            -->
                            <span class="title">Live Usage @</span><span class="title" id="last_updated"></span>
                            <div id="live_donut_chart"></div>
                        </center>
                    </div>
                </div>

                <!-- live metric cards -->
                <div class="container text-white text-center">
                    <div id="live_metric_grid" class="row row-cols-2">

                        <div class="col"
                             data-bs-toggle="tooltip" 
                             data-bs-placement="bottom"
                             data-bs-custom-class="custom-tooltip"
                             data-bs-title="Live Grid Import (W/kW). This is the real-time power being drawn from the electricity supply grid">

                            <div class="card-transparent text-center mt-0">
                                <div class="card-body">
                                    <table border="0" align="center">
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                <span id="live_import_icon" class="material-icons metric">login</span>
                                            </td>
                                            <td style="vertical-align: bottom;">
                                                <span id="live_import" style="metric metric-white">0</span>
                                                <span id="live_import_unit" class="metric-unit"></span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col"
                             data-bs-toggle="tooltip" 
                             data-bs-placement="bottom"
                             data-bs-custom-class="custom-tooltip"
                             data-bs-title="Live PV Yield (W/kW). This is the real-time power being generated from the solar panels">

                            <div class="card-transparent text-center mt-0">
                                <div class="card-body">
                                    <table border="0" align="center">
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                <span id="live_solar_icon" class="material-icons metric">solar_power</span>
                                            </td>
                                            <td style="vertical-align: bottom;">
                                                <span id="live_solar" style="metric metric-white">0</span>
                                                <span id="live_solar_unit" class="metric-unit"></span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col"
                             data-bs-toggle="tooltip" 
                             data-bs-placement="bottom"
                             data-bs-custom-class="custom-tooltip"
                             data-bs-title="Live Consumption (W/kW). This is the real-time power being consumed by the premises">

                            <div class="card-transparent text-center mt-0">
                                <div class="card-body">
                                    <table border="0" align="center">
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                <span id="live_consumed_icon" class="material-icons metric">home</span>
                                            </td>
                                            <td style="vertical-align: bottom;">
                                                <span id="live_consumed" style="metric metric-white">0</span>
                                                <span id="live_consumed_unit" class="metric-unit"></span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col"
                             data-bs-toggle="tooltip" 
                             data-bs-placement="bottom"
                             data-bs-custom-class="custom-tooltip"
                             data-bs-title="Live PV Export (W/kW). This is the real-time PV surplus being exported to the grid">

                            <div class="card-transparent text-center mt-0">
                                <div class="card-body">
                                    <table border="0" align="center">
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                <span id="live_export_icon" class="material-icons metric">logout</span>
                                            </td>
                                            <td style="vertical-align: bottom;">
                                                <span id="live_export" style="metric metric-white">0</span>
                                                <span id="live_export_unit" class="metric-unit"></span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
                <!-- live metric cards -->

                <!-- overall donut -->
                <div id="overall_chart_div" class="card-transparent text-white text-center mt-2">
                    <div class="card-body text-center">
                        <center>
                            <div id="overall_donut_title" class="title">Overall Usage</div>
                            <div id="overall_donut_chart"></div>
                        </center>
                    </div>
                </div>

                <!-- overall metric cards -->
                <div class="container text-white text-center">
                    <div id="overall_metric_grid" class="row row-cols-2">

                        <div class="col"
                             data-bs-toggle="tooltip" 
                             data-bs-placement="bottom"
                             data-bs-custom-class="custom-tooltip"
                             data-bs-title="Grid Import (kWh). This is the overall power drawn from the electricity supply grid">

                            <div class="card-transparent text-center mt-0">
                                <div class="card-body">
                                    <table border="0" align="center">
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                <span id="overall_import_icon" class="material-icons metric">login</span>
                                            </td>
                                            <td style="vertical-align: bottom;">
                                                <span id="overall_import" style="metric metric-white">0</span>
                                                <span class="metric-unit">kWh</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col"
                             data-bs-toggle="tooltip" 
                             data-bs-placement="bottom"
                             data-bs-custom-class="custom-tooltip"
                             data-bs-title="PV Yield (kWh). This is the overall power generated from the solar panels">

                            <div class="card-transparent text-center mt-0">
                                <div class="card-body">
                                    <table border="0" align="center">
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                <span id="overall_solar_icon" class="material-icons metric">solar_power</span>
                                            </td>
                                            <td style="vertical-align: bottom;">
                                                <span id="overall_solar" style="metric metric-white">0</span>
                                                <span class="metric-unit">kWh</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col"
                             data-bs-toggle="tooltip" 
                             data-bs-placement="bottom"
                             data-bs-custom-class="custom-tooltip"
                             data-bs-title="Consumption (kW). This is the overall power consumed by the premises">

                            <div class="card-transparent text-center mt-0">
                                <div class="card-body">
                                    <table border="0" align="center">
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                <span id="overall_consumed_icon" class="material-icons metric">home</span>
                                            </td>
                                            <td style="vertical-align: bottom;">
                                                <span id="overall_consumed" style="metric metric-white">0</span>
                                                <span class="metric-unit">kWh</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col"
                             data-bs-toggle="tooltip" 
                             data-bs-placement="bottom"
                             data-bs-custom-class="custom-tooltip"
                             data-bs-title="PV Export (kW). This is the overall PV surplus exported to the grid">

                            <div class="card-transparent text-center mt-0">
                                <div class="card-body">
                                    <table border="0" align="center">
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                <span id="overall_export_icon" class="material-icons metric">logout</span>
                                            </td>
                                            <td style="vertical-align: bottom;">
                                                <span id="overall_export" style="metric metric-white">0</span>
                                                <span class="metric-unit">kWh</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col"
                             data-bs-toggle="tooltip" 
                             data-bs-placement="bottom"
                             data-bs-custom-class="custom-tooltip"
                             data-bs-title="CO2 (g/kg). This is the overall CO2 emissions avoided by the PV generation">

                            <div class="card-transparent text-center mt-0">
                                <div class="card-body">
                                    <table border="0" align="center">
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                <span id="overall_co2_icon" class="material-icons metric">co2</span>
                                            </td>
                                            <td style="vertical-align: bottom;">
                                                <span id="overall_co2" style="metric metric-white">0</span>
                                                <span id="overall_co2_unit" class="metric-unit">kg</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col"
                             data-bs-toggle="tooltip" 
                             data-bs-placement="bottom"
                             data-bs-custom-class="custom-tooltip"
                             data-bs-title="Trees planted. This is the overall PV generation represented as trees planted">

                            <div class="card-transparent text-center mt-0">
                                <div class="card-body">
                                    <table border="0" align="center">
                                        <tr>
                                            <td style="vertical-align: middle;">
                                                <span id="overall_trees_icon" class="material-icons metric">forest</span>
                                            </td>
                                            <td style="vertical-align: bottom;">
                                                <span id="overall_trees" style="metric metric-white">0</span>
                                                <span class="metric-unit">trees</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>


                    </div>

                </div>
                <!-- overall metric cards -->

            </div>
            <!-- end Left column for live usage and metrics -->

            <!-- Right column for day, month and year graphs -->
            <div id="chart_column" class="col mt-2">
                <div class="row">
                    <div class="col">
                        <center><div class="title">Last 36 Hours</div></center>
                        <div id="day_chart"></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <center><div class="title">Last 30 Days</div></center>
                        <div id="month_chart"></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <center><div class="title">Last 12 Months</div></center>
                        <div id="year_chart"></div>
                    </div>
                </div>


            </div>
            <!-- Right column for day, month and year graphs -->

        </div>
    </div>
</body>
